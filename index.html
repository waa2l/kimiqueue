<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام إدارة الطباب الذكي - البوابة الرئيسية</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabaseClient.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 'arabic': ['Cairo', 'sans-serif'] },
                    colors: {
                        'primary': '#1e40af',
                        'secondary': '#3b82f6',
                        'accent': '#60a5fa',
                        'success': '#10b981',
                        'warning': '#f59e0b',
                        'danger': '#ef4444'
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #f3f4f6; }
        .hero-gradient { background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%); }
        .card-hover { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .glass-effect { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
    </style>
</head>
<body class="font-arabic text-gray-800">

    <div class="hero-gradient text-white pb-32 pt-20 rounded-b-[3rem] shadow-xl relative overflow-hidden">
        <div class="absolute top-0 left-0 w-full h-full opacity-10">
            <i class="fas fa-heartbeat absolute top-10 left-10 text-9xl"></i>
            <i class="fas fa-user-md absolute bottom-10 right-10 text-9xl"></i>
        </div>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10 text-center">
            <h1 class="text-4xl md:text-6xl font-bold mb-6">نظام إدارة الطباب الذكي</h1>
            <p class="text-xl md:text-2xl text-blue-100 mb-10 max-w-3xl mx-auto">
                منصة متكاملة لإدارة تجربة المرضى، العيادات، والمواعيد بكفاءة عالية
            </p>
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 max-w-4xl mx-auto mt-8">
                <div class="bg-white/20 backdrop-blur-md rounded-xl p-4 border border-white/30">
                    <div class="text-3xl font-bold" id="daily-patients">0</div>
                    <div class="text-sm text-blue-100">المرضى اليوم</div>
                </div>
                <div class="bg-white/20 backdrop-blur-md rounded-xl p-4 border border-white/30">
                    <div class="text-3xl font-bold" id="active-clinics">0</div>
                    <div class="text-sm text-blue-100">عيادات نشطة</div>
                </div>
                <div class="bg-white/20 backdrop-blur-md rounded-xl p-4 border border-white/30">
                    <div class="text-3xl font-bold" id="avg-wait-time">12د</div>
                    <div class="text-sm text-blue-100">وقت الانتظار</div>
                </div>
                <div class="bg-white/20 backdrop-blur-md rounded-xl p-4 border border-white/30">
                    <div class="text-3xl font-bold">98%</div>
                    <div class="text-sm text-blue-100">مستوى الرضا</div>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 -mt-24 relative z-20 pb-12">
        
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-12">
            <div class="flex items-center justify-between mb-6 border-b pb-4">
                <h2 class="text-2xl font-bold text-gray-800">
                    <i class="fas fa-satellite-dish text-success ml-2"></i>حالة العيادات المباشرة
                </h2>
                <a href="display.html" class="text-secondary hover:text-primary text-sm font-semibold">عرض الشاشة الكاملة ←</a>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="clinic-cards">
                <div class="col-span-full text-center py-12">
                    <i class="fas fa-circle-notch fa-spin text-4xl text-secondary mb-3"></i>
                    <p class="text-gray-500">جاري الاتصال بالنظام...</p>
                </div>
            </div>
        </div>

        <h2 class="text-2xl font-bold text-gray-800 mb-6 px-2 border-r-4 border-primary mr-2">بوابة النظام</h2>
        
        <div class="mb-10">
            <h3 class="text-lg font-semibold text-gray-500 mb-4 mr-2">خدمات المرضى</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6">
                
                <a href="client.html" class="glass-effect p-6 rounded-xl shadow-sm hover:shadow-md card-hover border-t-4 border-blue-500 group">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-xl group-hover:bg-blue-600 group-hover:text-white transition-colors">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <i class="fas fa-arrow-left text-gray-300 group-hover:text-blue-500"></i>
                    </div>
                    <h3 class="text-lg font-bold text-gray-800 mb-1">متابعة الدور</h3>
                    <p class="text-sm text-gray-500">للمرضى لمتابعة رقم الدور عبر الجوال</p>
                </a>
<a href="profile.html" class="glass-effect p-6 rounded-xl shadow-sm hover:shadow-md card-hover border-t-4 border-indigo-600 group relative overflow-hidden">
    <div class="absolute top-0 left-0 bg-indigo-600 text-white text-xs px-2 py-1 rounded-br">جديد</div>
    
    <div class="flex items-center justify-between mb-4">
        <div class="w-12 h-12 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center text-xl group-hover:bg-indigo-600 group-hover:text-white transition-colors">
            <i class="fas fa-user-circle"></i>
        </div>
        <i class="fas fa-arrow-left text-gray-300 group-hover:text-indigo-600"></i>
    </div>
    <h3 class="text-lg font-bold text-gray-800 mb-1">ملفي الشخصي</h3>
    <p class="text-sm text-gray-500">سجل الدخول لمتابعة مواعيدك واستشاراتك السابقة</p>
</a>
                <a href="appointments.html" class="glass-effect p-6 rounded-xl shadow-sm hover:shadow-md card-hover border-t-4 border-indigo-500 group">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center text-xl group-hover:bg-indigo-600 group-hover:text-white transition-colors">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <i class="fas fa-arrow-left text-gray-300 group-hover:text-indigo-500"></i>
                    </div>
                    <h3 class="text-lg font-bold text-gray-800 mb-1">حجز المواعيد</h3>
                    <p class="text-sm text-gray-500">حجز موعد جديد واختيار الطبيب</p>
                </a>

                <a href="consultations.html" class="glass-effect p-6 rounded-xl shadow-sm hover:shadow-md card-hover border-t-4 border-pink-500 group">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 rounded-full bg-pink-100 text-pink-600 flex items-center justify-center text-xl group-hover:bg-pink-600 group-hover:text-white transition-colors">
                            <i class="fas fa-file-medical"></i>
                        </div>
                        <i class="fas fa-arrow-left text-gray-300 group-hover:text-pink-500"></i>
                    </div>
                    <h3 class="text-lg font-bold text-gray-800 mb-1">الاستشارات والملف</h3>
                    <p class="text-sm text-gray-500">فتح ملف طبي وطلب استشارة</p>
                </a>

            </div>
        </div>

        <div class="mb-10">
            <h3 class="text-lg font-semibold text-gray-500 mb-4 mr-2">الطاقم والتشغيل</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6">

                <a href="doctor-portal.html" class="glass-effect p-6 rounded-xl shadow-sm hover:shadow-md card-hover border-t-4 border-teal-500 group">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 rounded-full bg-teal-100 text-teal-600 flex items-center justify-center text-xl group-hover:bg-teal-600 group-hover:text-white transition-colors">
                            <i class="fas fa-user-md"></i>
                        </div>
                        <i class="fas fa-arrow-left text-gray-300 group-hover:text-teal-500"></i>
                    </div>
                    <h3 class="text-lg font-bold text-gray-800 mb-1">بوابة الأطباء</h3>
                    <p class="text-sm text-gray-500">لإدارة الحضور والرد على الاستشارات</p>
                </a>

                <a href="control.html" class="glass-effect p-6 rounded-xl shadow-sm hover:shadow-md card-hover border-t-4 border-purple-500 group">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center text-xl group-hover:bg-purple-600 group-hover:text-white transition-colors">
                            <i class="fas fa-gamepad"></i>
                        </div>
                        <i class="fas fa-arrow-left text-gray-300 group-hover:text-purple-500"></i>
                    </div>
                    <h3 class="text-lg font-bold text-gray-800 mb-1">تحكم العيادة</h3>
                    <p class="text-sm text-gray-500">لوحة الممرض/الطبيب لمناداة الأرقام</p>
                </a>

                <a href="printing.html" class="glass-effect p-6 rounded-xl shadow-sm hover:shadow-md card-hover border-t-4 border-orange-500 group">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 rounded-full bg-orange-100 text-orange-600 flex items-center justify-center text-xl group-hover:bg-orange-600 group-hover:text-white transition-colors">
                            <i class="fas fa-print"></i>
                        </div>
                        <i class="fas fa-arrow-left text-gray-300 group-hover:text-orange-500"></i>
                    </div>
                    <h3 class="text-lg font-bold text-gray-800 mb-1">طباعة التذاكر</h3>
                    <p class="text-sm text-gray-500">نظام الكشك لطباعة أرقام الانتظار</p>
                </a>

            </div>
        </div>

        <div class="mb-10">
            <h3 class="text-lg font-semibold text-gray-500 mb-4 mr-2">الإدارة والعرض</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6">

                <a href="admin.html" class="glass-effect p-6 rounded-xl shadow-sm hover:shadow-md card-hover border-t-4 border-gray-600 group">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 rounded-full bg-gray-100 text-gray-600 flex items-center justify-center text-xl group-hover:bg-gray-600 group-hover:text-white transition-colors">
                            <i class="fas fa-cogs"></i>
                        </div>
                        <i class="fas fa-arrow-left text-gray-300 group-hover:text-gray-600"></i>
                    </div>
                    <h3 class="text-lg font-bold text-gray-800 mb-1">الإدارة العامة</h3>
                    <p class="text-sm text-gray-500">إعدادات النظام، العيادات، والموظفين</p>
                </a>

                <a href="display.html" class="glass-effect p-6 rounded-xl shadow-sm hover:shadow-md card-hover border-t-4 border-cyan-500 group">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 rounded-full bg-cyan-100 text-cyan-600 flex items-center justify-center text-xl group-hover:bg-cyan-600 group-hover:text-white transition-colors">
                            <i class="fas fa-desktop"></i>
                        </div>
                        <i class="fas fa-arrow-left text-gray-300 group-hover:text-cyan-600"></i>
                    </div>
                    <h3 class="text-lg font-bold text-gray-800 mb-1">شاشة العرض</h3>
                    <p class="text-sm text-gray-500">الشاشة الرئيسية لعرض الطوابير للجمهور</p>
                </a>

                <a href="about.html" class="glass-effect p-6 rounded-xl shadow-sm hover:shadow-md card-hover border-t-4 border-emerald-500 group">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 rounded-full bg-emerald-100 text-emerald-600 flex items-center justify-center text-xl group-hover:bg-emerald-600 group-hover:text-white transition-colors">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <i class="fas fa-arrow-left text-gray-300 group-hover:text-emerald-600"></i>
                    </div>
                    <h3 class="text-lg font-bold text-gray-800 mb-1">عن النظام</h3>
                    <p class="text-sm text-gray-500">معلومات الإصدار والدعم الفني</p>
                </a>

            </div>
        </div>

    </div>

    <footer class="bg-white border-t mt-12 py-8">
        <div class="max-w-7xl mx-auto px-4 text-center text-gray-500 text-sm">
            <p class="mb-2">© 2025 جميع الحقوق محفوظة - نظام إدارة الطباب الذكي</p>
            <p>تم التطوير بواسطة فريق تقنية المعلومات</p>
        </div>
    </footer>

    <script>
        function checkSupabaseReady() {
            return new Promise((resolve) => {
                if (window.supabaseHelpers) resolve();
                else setTimeout(() => checkSupabaseReady().then(resolve), 100);
            });
        }

        async function loadData() {
            await checkSupabaseReady();
            try {
                const clinics = await window.supabaseHelpers.getClinics();
                
                // Update Stats
                document.getElementById('active-clinics').textContent = clinics.filter(c => c.status === 'active').length;
                const totalPatients = clinics.reduce((sum, c) => sum + (c.current_number || 0), 0);
                document.getElementById('daily-patients').textContent = totalPatients;

                // Update Clinic Cards
                const container = document.getElementById('clinic-cards');
                container.innerHTML = '';
                
                if (clinics.length === 0) {
                    container.innerHTML = `
                        <div class="col-span-full text-center py-8">
                            <i class="fas fa-inbox text-4xl text-gray-300 mb-4"></i>
                            <p class="text-gray-600">لا توجد عيادات نشطة حالياً</p>
                        </div>
                    `;
                    return;
                }
                
                clinics.forEach(clinic => {
                    const statusClass = clinic.status === 'active' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700';
                    const statusText = clinic.status === 'active' ? 'مفتوحة' : 'مغلقة';
                    
                    const card = document.createElement('div');
                    card.className = 'bg-white border border-gray-100 p-5 rounded-xl shadow-sm hover:shadow-md transition-shadow';
                    card.innerHTML = `
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex items-center">
                                <div class="w-10 h-10 rounded-lg bg-blue-50 text-primary flex items-center justify-center text-lg ml-3">
                                    <i class="fas fa-stethoscope"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-gray-800">${clinic.name}</h4>
                                    <span class="text-xs ${statusClass} px-2 py-0.5 rounded-full">${statusText}</span>
                                </div>
                            </div>
                            <div class="text-center">
                                <div class="text-xs text-gray-500 mb-1">الدور الحالي</div>
                                <div class="text-2xl font-bold text-primary font-mono">${clinic.current_number}</div>
                            </div>
                        </div>
                        <div class="w-full bg-gray-100 rounded-full h-1.5 mb-2">
                            <div class="bg-primary h-1.5 rounded-full" style="width: ${Math.min(100, (clinic.current_number / 100) * 100)}%"></div>
                        </div>
                        <div class="flex justify-between text-xs text-gray-400">
                            <span>آخر نداء: ${clinic.lastCall || '-'}</span>
                            <span>شاشة ${clinic.screen}</span>
                        </div>
                    `;
                    container.appendChild(card);
                });
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Realtime Subscription
        function subscribeToUpdates() {
            if (window.supabaseHelpers && window.supabaseHelpers.subscribeToClinicUpdates) {
                window.supabaseHelpers.subscribeToClinicUpdates(() => {
                    loadData();
                });
            }
        }

        document.addEventListener('DOMContentLoaded', async () => {
            await loadData();
            subscribeToUpdates();
        });
    </script>
</body>
</html>
