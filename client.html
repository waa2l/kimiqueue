<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØµÙØ­Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ø¨Ø§Ø¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <!-- Supabase Client -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabaseClient.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'arabic': ['Cairo', 'sans-serif']
                    },
                    colors: {
                        'primary': '#1e40af',
                        'secondary': '#3b82f6',
                        'accent': '#60a5fa',
                        'success': '#10b981',
                        'warning': '#f59e0b',
                        'danger': '#ef4444'
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Cairo', sans-serif;
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .notification-badge {
            animation: bounce 1s infinite;
        }
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% { transform: translateY(0); }
            40%, 43% { transform: translateY(-10px); }
            70% { transform: translateY(-5px); }
        }
        .progress-ring {
            transform: rotate(-90deg);
        }
        .progress-ring-circle {
            transition: stroke-dashoffset 0.35s;
            transform-origin: 50% 50%;
        }
    </style>
</head>
<body class="bg-gray-50 font-arabic">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-2xl font-bold text-primary">ğŸ¥ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ø¨Ø§Ø¨</h1>
                    </div>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4 space-x-reverse">
                        <a href="index.html" class="text-gray-700 hover:text-primary px-3 py-2 rounded-md text-sm font-medium transition-colors">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                        <a href="admin.html" class="text-gray-700 hover:text-primary px-3 py-2 rounded-md text-sm font-medium transition-colors">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</a>
                        <a href="display.html" class="text-gray-700 hover:text-primary px-3 py-2 rounded-md text-sm font-medium transition-colors">Ø§Ù„Ø¹Ø±Ø¶</a>
                        <a href="control.html" class="text-gray-700 hover:text-primary px-3 py-2 rounded-md text-sm font-medium transition-colors">Ø§Ù„ØªØ­ÙƒÙ…</a>
                        <a href="client.html" class="text-primary hover:text-secondary px-3 py-2 rounded-md text-sm font-medium transition-colors">Ø§Ù„Ø¹Ù…ÙŠÙ„</a>
                        <a href="about.html" class="text-gray-700 hover:text-primary px-3 py-2 rounded-md text-sm font-medium transition-colors">Ø¹Ù† Ø§Ù„Ù†Ø¸Ø§Ù…</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h2 class="text-3xl font-bold text-gray-900 mb-4">Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¯ÙˆØ±</h2>
            <p class="text-lg text-gray-600">ØªØ§Ø¨Ø¹ Ø¯ÙˆØ±Ùƒ ÙˆØ§Ø³ØªÙ„Ù… ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø¹Ù†Ø¯ ÙˆØµÙˆÙ„Ùƒ</p>
        </div>

        <!-- Clinic Selection -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h3 class="text-xl font-semibold mb-4">Ø§Ø®ØªØ± Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <button onclick="selectClinic(1)" class="clinic-option p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors text-center">
                    <div class="text-2xl mb-2">ğŸ¥</div>
                    <div class="font-semibold">Ø¹ÙŠØ§Ø¯Ø© Ø·Ø¨ Ø§Ù„Ø£Ø³Ø±Ø©</div>
                    <div class="text-sm text-gray-600">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ: <span class="font-bold text-primary">15</span></div>
                </button>
                <button onclick="selectClinic(2)" class="clinic-option p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors text-center">
                    <div class="text-2xl mb-2">ğŸ«€</div>
                    <div class="font-semibold">Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø¨Ø§Ø·Ù†ÙŠØ©</div>
                    <div class="text-sm text-gray-600">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ: <span class="font-bold text-primary">22</span></div>
                </button>
                <button onclick="selectClinic(3)" class="clinic-option p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors text-center">
                    <div class="text-2xl mb-2">ğŸ‘¶</div>
                    <div class="font-semibold">Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø·ÙØ§Ù„</div>
                    <div class="text-sm text-gray-600">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ: <span class="font-bold text-primary">8</span></div>
                </button>
                <button onclick="selectClinic(4)" class="clinic-option p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors text-center">
                    <div class="text-2xl mb-2">ğŸ¤±</div>
                    <div class="font-semibold">Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ù†Ø³Ø§Ø¡</div>
                    <div class="text-sm text-gray-600">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ: <span class="font-bold text-primary">31</span></div>
                </button>
                <button onclick="selectClinic(5)" class="clinic-option p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors text-center">
                    <div class="text-2xl mb-2">ğŸ¦·</div>
                    <div class="font-semibold">Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù†</div>
                    <div class="text-sm text-gray-600">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ: <span class="font-bold text-primary">12</span></div>
                </button>
                <button onclick="selectClinic(6)" class="clinic-option p-4 border-2 border-gray-200 rounded-lg hover:border-primary transition-colors text-center">
                    <div class="text-2xl mb-2">ğŸ§´</div>
                    <div class="font-semibold">Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø¬Ù„Ø¯ÙŠØ©</div>
                    <div class="text-sm text-gray-600">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ: <span class="font-bold text-primary">5</span></div>
                </button>
            </div>
        </div>

        <!-- Queue Tracking -->
        <div id="queue-section" class="hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Current Status -->
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-semibold">Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙˆØ±</h3>
                            <div class="flex items-center space-x-2 space-x-reverse">
                                <span class="status-indicator bg-green-500 w-3 h-3 rounded-full"></span>
                                <span class="text-sm text-gray-600">Ù…ØªØ§Ø¨Ø¹Ø© Ù†Ø´Ø·Ø©</span>
                            </div>
                        </div>

                        <!-- Current Number Display -->
                        <div class="text-center mb-8">
                            <div class="text-6xl font-bold text-primary mb-2" id="current-number-display">15</div>
                            <div class="text-lg text-gray-600">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
                            <div class="text-sm text-gray-500" id="clinic-name-display">Ø¹ÙŠØ§Ø¯Ø© Ø·Ø¨ Ø§Ù„Ø£Ø³Ø±Ø©</div>
                        </div>

                        <!-- Your Number Input -->
                        <div class="bg-gray-50 p-4 rounded-lg mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Ø±Ù‚Ù… Ø§Ù„ØªØ°ÙƒØ±Ø© Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ</label>
                            <div class="flex space-x-3 space-x-reverse">
                                <input type="number" id="ticket-number" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ØªØ°ÙƒØ±Ø©" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-primary">
                                <button onclick="startTracking()" class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-secondary transition-colors">
                                    <i class="fas fa-bell ml-2"></i>Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©
                                </button>
                            </div>
                        </div>

                        <!-- Progress Ring -->
                        <div class="flex justify-center mb-6" id="progress-container" style="display: none;">
                            <div class="relative">
                                <svg class="progress-ring w-32 h-32" viewBox="0 0 120 120">
                                    <circle cx="60" cy="60" r="50" stroke="#e5e7eb" stroke-width="8" fill="none"/>
                                    <circle id="progress-circle" cx="60" cy="60" r="50" stroke="#3b82f6" stroke-width="8" fill="none" 
                                            stroke-dasharray="314" stroke-dashoffset="314" class="progress-ring-circle"/>
                                </svg>
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-primary" id="remaining-number">5</div>
                                        <div class="text-xs text-gray-600">Ù…ØªØ¨Ù‚ÙŠ</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Estimated Wait Time -->
                        <div class="bg-blue-50 p-4 rounded-lg text-center" id="wait-time-info" style="display: none;">
                            <div class="text-sm text-blue-800 mb-1">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ Ù„Ù„Ø§Ù†ØªØ¸Ø§Ø±</div>
                            <div class="text-2xl font-bold text-blue-900" id="estimated-wait">12 Ø¯Ù‚ÙŠÙ‚Ø©</div>
                        </div>
                    </div>
                </div>

                <!-- Notifications & Settings -->
                <div class="space-y-6">
                    <!-- Notification Settings -->
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-semibold mb-4">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡</h3>
                        <div class="space-y-4">
                            <label class="flex items-center">
                                <input type="checkbox" id="browser-notification" checked class="ml-2">
                                <span class="text-sm">ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…ØªØµÙØ­</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="sound-notification" checked class="ml-2">
                                <span class="text-sm">ØªÙ†Ø¨ÙŠÙ‡ ØµÙˆØªÙŠ</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="vibration-notification" class="ml-2">
                                <span class="text-sm">Ø§Ù‡ØªØ²Ø§Ø² (Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„)</span>
                            </label>
                        </div>
                        
                        <!-- Contact Info -->
                        <div class="mt-6 pt-6 border-t">
                            <h4 class="font-medium mb-3">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</h4>
                            <div class="space-y-3">
                                <input type="email" id="client-email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                <input type="tel" id="client-phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-semibold mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                        <div class="space-y-3">
                            <button onclick="refreshQueue()" class="w-full bg-gray-100 text-gray-700 p-3 rounded-lg hover:bg-gray-200 transition-colors text-center">
                                <i class="fas fa-sync-alt ml-2"></i>ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©
                            </button>
                            <button onclick="showComplaintForm()" class="w-full bg-warning text-white p-3 rounded-lg hover:bg-yellow-600 transition-colors text-center">
                                <i class="fas fa-comment-alt ml-2"></i>Ø´ÙƒÙˆÙ‰/Ø§Ù‚ØªØ±Ø§Ø­
                            </button>
                            <button onclick="stopTracking()" id="stop-tracking-btn" class="w-full bg-danger text-white p-3 rounded-lg hover:bg-red-600 transition-colors text-center" style="display: none;">
                                <i class="fas fa-stop ml-2"></i>Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©
                            </button>
                        </div>
                    </div>

                    <!-- Your Queue Position -->
                    <div class="bg-white rounded-lg shadow-lg p-6" id="queue-position" style="display: none;">
                        <h3 class="text-lg font-semibold mb-4">Ù…ÙˆÙ‚ÙÙƒ ÙÙŠ Ø§Ù„Ø·Ø§Ø¨ÙˆØ±</h3>
                        <div class="text-center">
                            <div class="text-4xl font-bold text-primary mb-2" id="position-number">5</div>
                            <div class="text-sm text-gray-600">Ù…ØªÙ‚Ø¯Ù…Ù‹Ø§ Ù„Ùƒ</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Complaint Modal -->
        <div id="complaint-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">Ø´ÙƒÙˆÙ‰ Ø£Ùˆ Ø§Ù‚ØªØ±Ø§Ø­</h3>
                    <button onclick="closeComplaintForm()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="complaint-form">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ù†ÙˆØ¹</label>
                        <select id="complaint-type" class="w-full px-3 py-2 border rounded-lg" required>
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹</option>
                            <option value="complaint">Ø´ÙƒÙˆÙ‰</option>
                            <option value="suggestion">Ø§Ù‚ØªØ±Ø§Ø­</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</label>
                        <textarea id="complaint-text" rows="4" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§... (140 Ø­Ø±Ù ÙƒØ­Ø¯ Ø£Ø¯Ù†Ù‰)" class="w-full px-3 py-2 border rounded-lg" required></textarea>
                        <div class="text-xs text-gray-500 mt-1" id="char-count">0/140 Ø­Ø±Ù</div>
                    </div>
                    <div class="flex space-x-3 space-x-reverse">
                        <button type="submit" class="flex-1 bg-primary text-white py-2 rounded-lg">Ø¥Ø±Ø³Ø§Ù„</button>
                        <button type="button" onclick="closeComplaintForm()" class="flex-1 bg-gray-500 text-white py-2 rounded-lg">Ø¥Ù„ØºØ§Ø¡</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="fixed top-20 left-1/2 transform -translate-x-1/2 bg-primary text-white px-6 py-3 rounded-lg shadow-lg z-50 hidden">
        <div class="flex items-center">
            <i class="fas fa-bell mr-2"></i>
            <span id="notification-text"></span>
        </div>
    </div>

    <script>
        let selectedClinic = null;
        let trackingActive = false;
        let userTicketNumber = null;
        let currentClinicNumber = 15;
        let notificationPermission = false;

        // Sample clinic data
        const clinics = {
            1: { name: 'Ø¹ÙŠØ§Ø¯Ø© Ø·Ø¨ Ø§Ù„Ø£Ø³Ø±Ø©', current: 15, status: 'active' },
            2: { name: 'Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø¨Ø§Ø·Ù†ÙŠØ©', current: 22, status: 'active' },
            3: { name: 'Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø·ÙØ§Ù„', current: 8, status: 'paused' },
            4: { name: 'Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ù†Ø³Ø§Ø¡', current: 31, status: 'active' },
            5: { name: 'Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù†', current: 12, status: 'active' },
            6: { name: 'Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø¬Ù„Ø¯ÙŠØ©', current: 5, status: 'active' }
        };

        // Request notification permission
        function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission().then(permission => {
                    notificationPermission = permission === 'granted';
                });
            } else if (Notification.permission === 'granted') {
                notificationPermission = true;
            }
        }

        function selectClinic(clinicId) {
            selectedClinic = clinicId;
            const clinic = clinics[clinicId];
            
            // Update UI
            document.getElementById('current-number-display').textContent = clinic.current;
            document.getElementById('clinic-name-display').textContent = clinic.name;
            currentClinicNumber = clinic.current;
            
            // Show queue section
            document.getElementById('queue-section').classList.remove('hidden');
            
            // Highlight selected clinic
            document.querySelectorAll('.clinic-option').forEach(btn => {
                btn.classList.remove('border-primary', 'bg-blue-50');
            });
            event.target.closest('.clinic-option').classList.add('border-primary', 'bg-blue-50');
            
            // Request notification permission
            requestNotificationPermission();
        }

        function startTracking() {
            const ticketNumber = parseInt(document.getElementById('ticket-number').value);
            
            if (!ticketNumber || ticketNumber <= 0) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„ØªØ°ÙƒØ±Ø©');
                return;
            }
            
            if (!selectedClinic) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }
            
            userTicketNumber = ticketNumber;
            trackingActive = true;
            
            // Update UI
            document.getElementById('progress-container').style.display = 'block';
            document.getElementById('wait-time-info').style.display = 'block';
            document.getElementById('queue-position').style.display = 'block';
            document.getElementById('stop-tracking-btn').style.display = 'block';
            
            // Calculate and update position
            updateQueuePosition();
            
            // Show success message
            showNotification(`ØªÙ… Ø¨Ø¯Ø¡ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªØ°ÙƒØ±Ø© Ø±Ù‚Ù… ${ticketNumber}`);
            
            // Start monitoring
            startQueueMonitoring();
        }

        function updateQueuePosition() {
            if (!userTicketNumber || !selectedClinic) return;
            
            const clinic = clinics[selectedClinic];
            const remaining = Math.max(0, userTicketNumber - clinic.current);
            const position = remaining + 1;
            
            // Update position display
            document.getElementById('position-number').textContent = position;
            document.getElementById('remaining-number').textContent = remaining;
            
            // Update progress ring
            const progressCircle = document.getElementById('progress-circle');
            const circumference = 2 * Math.PI * 50; // radius = 50
            const progress = Math.max(0, (clinic.current / userTicketNumber) * 100);
            const offset = circumference - (progress / 100) * circumference;
            progressCircle.style.strokeDashoffset = offset;
            
            // Update estimated wait time
            const estimatedWait = remaining * 3; // 3 minutes per patient
            document.getElementById('estimated-wait').textContent = `${estimatedWait} Ø¯Ù‚ÙŠÙ‚Ø©`;
        }

        function startQueueMonitoring() {
            // Simulate real-time updates
            setInterval(() => {
                if (trackingActive && selectedClinic) {
                    // Simulate queue movement
                    const clinic = clinics[selectedClinic];
                    if (Math.random() > 0.7) { // 30% chance of queue moving
                        clinic.current++;
                        document.getElementById('current-number-display').textContent = clinic.current;
                        updateQueuePosition();
                        
                        // Check if it's user's turn
                        if (clinic.current >= userTicketNumber) {
                            triggerUserNotification();
                        }
                    }
                }
            }, 5000);
        }

        function triggerUserNotification() {
            const message = `Ø­Ø§Ù† Ø§Ù„Ø¢Ù† Ø¯ÙˆØ±Ùƒ Ø±Ù‚Ù… ${userTicketNumber} ÙÙŠ ${clinics[selectedClinic].name}`;
            
            // Browser notification
            if (notificationPermission) {
                new Notification('Ø­Ø§Ù† Ø¯ÙˆØ±Ùƒ!', {
                    body: message,
                    icon: '/favicon.ico',
                    badge: '/favicon.ico'
                });
            }
            
            // Show in-app notification
            showNotification(message);
            
            // Play sound if enabled
            if (document.getElementById('sound-notification').checked) {
                playNotificationSound();
            }
            
            // Vibrate if enabled and on mobile
            if (document.getElementById('vibration-notification').checked && 'vibrate' in navigator) {
                navigator.vibrate([200, 100, 200]);
            }
            
            // Stop tracking
            stopTracking();
        }

        function playNotificationSound() {
            // Create a simple beep sound
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 800;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 1);
        }

        function stopTracking() {
            trackingActive = false;
            
            // Hide tracking elements
            document.getElementById('progress-container').style.display = 'none';
            document.getElementById('wait-time-info').style.display = 'none';
            document.getElementById('queue-position').style.display = 'none';
            document.getElementById('stop-tracking-btn').style.display = 'none';
            
            // Clear ticket number
            document.getElementById('ticket-number').value = '';
            
            showNotification('ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©');
        }

        function refreshQueue() {
            if (selectedClinic) {
                const clinic = clinics[selectedClinic];
                document.getElementById('current-number-display').textContent = clinic.current;
                updateQueuePosition();
                showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©');
            }
        }

        function showComplaintForm() {
            document.getElementById('complaint-modal').classList.remove('hidden');
            document.getElementById('complaint-modal').classList.add('flex');
        }

        function closeComplaintForm() {
            document.getElementById('complaint-modal').classList.add('hidden');
            document.getElementById('complaint-modal').classList.remove('flex');
            document.getElementById('complaint-form').reset();
            document.getElementById('char-count').textContent = '0/140 Ø­Ø±Ù';
        }

        function showNotification(message) {
            const notification = document.getElementById('notification');
            document.getElementById('notification-text').textContent = message;
            notification.classList.remove('hidden');
            
            setTimeout(() => {
                notification.classList.add('hidden');
            }, 3000);
        }

        // Character count for complaint form
        document.getElementById('complaint-text').addEventListener('input', function() {
            const length = this.value.length;
            document.getElementById('char-count').textContent = `${length}/140 Ø­Ø±Ù`;
            
            if (length < 140) {
                document.getElementById('char-count').classList.add('text-red-500');
            } else {
                document.getElementById('char-count').classList.remove('text-red-500');
            }
        });

        // Handle complaint form submission
        document.getElementById('complaint-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const type = document.getElementById('complaint-type').value;
            const text = document.getElementById('complaint-text').value;
            
            if (text.length < 140) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ø±Ø³Ø§Ù„Ø© Ù„Ø§ ØªÙ‚Ù„ Ø¹Ù† 140 Ø­Ø±Ù');
                return;
            }
            
            // Simulate sending complaint
            showNotification('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­. Ø´ÙƒØ±Ø§Ù‹ Ù„Ù…Ø´Ø§Ø±ÙƒØªÙƒ.');
            closeComplaintForm();
        });

        // Simulate real-time updates
        setInterval(() => {
            if (selectedClinic) {
                const clinic = clinics[selectedClinic];
                if (Math.random() > 0.8) { // 20% chance of update
                    clinic.current++;
                    document.getElementById('current-number-display').textContent = clinic.current;
                    
                    if (trackingActive) {
                        updateQueuePosition();
                    }
                }
            }
        }, 10000);
    </script>
</body>
</html>
